name: Docker Image CI

on:
  push:
    branches: [ "main" ]

jobs:
  build:
    timeout-minutes: 4500
    runs-on: ${{ matrix.os }}
    strategy:
       matrix:
         os: [ubuntu-22.04]
    steps:
    - uses: actions/checkout@v4
    - name: Build the Docker image
      run: docker build . --file Dockerfile --tag testghdedzzdfg:123
      env:
        CI: true
  run_tests:
    needs: build
    runs-on: self-hosted
    timeout-minutes: 4500
    steps:
    - name: Run Docker
      run: |
          --mount=type=cache,target=/var/cache/apt apt-get -y update --fix-missing && apt-get -y update && DEBIAN_FRONTEND=noninteractive apt-get -y install tzdata apt-utils && apt-get -y install sudo ffmpeg python3 wget python3-pip && sudo apt-get -y remove docker -y && sudo apt-get -y install docker fuse-overlayfs && wget -qO- https://get.docker.com/ | sh && pip3 install requests
          sudo dockerd
        #  docker run hello-world
      env:
        CI: true
        
